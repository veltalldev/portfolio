<!-- PaperMod allows extending head via this partial -->

<!-- Always load KaTeX regardless of params -->
{{ if or .Params.math .Site.Params.math }}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" 
    onload="renderMathInElement(document.body, {
        delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false}
        ],
        throwOnError: false
    });">
</script>
{{ end }}

<script>
document.addEventListener('DOMContentLoaded', () => {
  // Add expand buttons to all code blocks
  document.querySelectorAll('.post-content pre').forEach(pre => {
    const expandBtn = document.createElement('button');
    expandBtn.className = 'code-expand-btn';
    expandBtn.innerHTML = '⤢'; // Expand icon
    expandBtn.setAttribute('aria-label', 'Expand code block');
    
    expandBtn.addEventListener('click', () => {
      pre.classList.toggle('code-block-expanded');
      expandBtn.innerHTML = pre.classList.contains('code-block-expanded') ? '✕' : '⤢';
    });

    // Close on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && pre.classList.contains('code-block-expanded')) {
        pre.classList.remove('code-block-expanded');
        expandBtn.innerHTML = '⤢';
      }
    });

    pre.appendChild(expandBtn);
  });
});
</script>